<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cable-Monitor by Horvat &amp; Wey: Core/Src/calculation.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">cable-Monitor by Horvat &amp; Wey<span id="projectnumber">&#160;V1.0</span>
   </div>
   <div id="projectbrief">ZHAW ET.PM3</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li><li class="navelem"><a class="el" href="dir_b596f468b52957496e4f78b80e029268.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">calculation.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Calculations for displaying the measurements.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="calculation_8h_source.html">calculation.h</a>&quot;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;<a class="el" href="measuring_8h_source.html">measuring.h</a>&quot;</code><br />
<code>#include &quot;stm32f4xx.h&quot;</code><br />
<code>#include &quot;stm32f4xx_hal.h&quot;</code><br />
<code>#include &quot;arm_math.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for calculation.c:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c__incl.png" border="0" usemap="#a_core_2_src_2calculation_8c" alt=""/></div>
</div>
</div>
<p><a href="calculation_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a42e162ee7b8b8c2663d1dbd31c7b590b" id="r_a42e162ee7b8b8c2663d1dbd31c7b590b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a42e162ee7b8b8c2663d1dbd31c7b590b">ARM_MATH_CM4</a></td></tr>
<tr class="separator:a42e162ee7b8b8c2663d1dbd31c7b590b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a903c0e7083ad87b2f7420dcdcd409f99" id="r_a903c0e7083ad87b2f7420dcdcd409f99"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a903c0e7083ad87b2f7420dcdcd409f99">D_P</a>&#160;&#160;&#160;19.7</td></tr>
<tr class="memdesc:a903c0e7083ad87b2f7420dcdcd409f99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Distance from the board center to pad center.  <br /></td></tr>
<tr class="separator:a903c0e7083ad87b2f7420dcdcd409f99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55777447b30ba437527bda91f69b8fba" id="r_a55777447b30ba437527bda91f69b8fba"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a55777447b30ba437527bda91f69b8fba">ACCURATE_MEASUREMENT_LOOPS</a>&#160;&#160;&#160;10</td></tr>
<tr class="memdesc:a55777447b30ba437527bda91f69b8fba"><td class="mdescLeft">&#160;</td><td class="mdescRight">How many loops for accu. meas.  <br /></td></tr>
<tr class="separator:a55777447b30ba437527bda91f69b8fba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa43ea9575b79b5b1c302b382fe1f189e" id="r_aa43ea9575b79b5b1c302b382fe1f189e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa43ea9575b79b5b1c302b382fe1f189e">CALIBRATION_MEASUREMENT_LOOPS</a>&#160;&#160;&#160;50</td></tr>
<tr class="memdesc:aa43ea9575b79b5b1c302b382fe1f189e"><td class="mdescLeft">&#160;</td><td class="mdescRight">How many loops for calibration meas.  <br /></td></tr>
<tr class="separator:aa43ea9575b79b5b1c302b382fe1f189e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ac0abc7c913167ecaf81778d57e7a17" id="r_a1ac0abc7c913167ecaf81778d57e7a17"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1ac0abc7c913167ecaf81778d57e7a17">POW2</a>(x)&#160;&#160;&#160;((x) * (x))</td></tr>
<tr class="memdesc:a1ac0abc7c913167ecaf81778d57e7a17"><td class="mdescLeft">&#160;</td><td class="mdescRight">Power of two.  <br /></td></tr>
<tr class="separator:a1ac0abc7c913167ecaf81778d57e7a17"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a9e58222624315d1b9029cc0bd7757b70" id="r_a9e58222624315d1b9029cc0bd7757b70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9e58222624315d1b9029cc0bd7757b70">calculate_coefficients_single_pad</a> (float32_t s[], float32_t d[], float32_t *a, float32_t *b, float32_t *c)</td></tr>
<tr class="separator:a9e58222624315d1b9029cc0bd7757b70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b4c4cf533fe366c1c5637d2853c823a" id="r_a9b4c4cf533fe366c1c5637d2853c823a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_f_f_t.html">FFT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a9b4c4cf533fe366c1c5637d2853c823a">calculate_freq_and_signalstrength</a> (float32_t input_samples[])</td></tr>
<tr class="memdesc:a9b4c4cf533fe366c1c5637d2853c823a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the frequency and signal strength using Fast Fourier Transform (<a class="el" href="struct_f_f_t.html">FFT</a>).  <br /></td></tr>
<tr class="separator:a9b4c4cf533fe366c1c5637d2853c823a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68538a6e3dec58db926981a4702d45fa" id="r_a68538a6e3dec58db926981a4702d45fa"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_d_i_s_t_a_n_c_e___a_n_g_l_e.html">DISTANCE_ANGLE</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a68538a6e3dec58db926981a4702d45fa">calculate_distance_and_angle</a> (float32_t signal_strength_r, float32_t signal_strength_l)</td></tr>
<tr class="memdesc:a68538a6e3dec58db926981a4702d45fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the distance and angle based on signal strengths.  <br /></td></tr>
<tr class="separator:a68538a6e3dec58db926981a4702d45fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a131fe6481430eaff914b335bbf3d565d" id="r_a131fe6481430eaff914b335bbf3d565d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a131fe6481430eaff914b335bbf3d565d">calculate_magnetic_coefficients</a> (float32_t s, float32_t d, float32_t cal_current, float32_t *a_magn)</td></tr>
<tr class="memdesc:a131fe6481430eaff914b335bbf3d565d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculates the magnetic coefficients.  <br /></td></tr>
<tr class="separator:a131fe6481430eaff914b335bbf3d565d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fddab1b09b687be16e69a9784d5b97b" id="r_a4fddab1b09b687be16e69a9784d5b97b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_a_c_c_u___f_f_t.html">ACCU_FFT</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4fddab1b09b687be16e69a9784d5b97b">accurate_FFT</a> (void)</td></tr>
<tr class="memdesc:a4fddab1b09b687be16e69a9784d5b97b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs accurate <a class="el" href="struct_f_f_t.html">FFT</a> calculation for signal strength and main frequency of each channel.  <br /></td></tr>
<tr class="separator:a4fddab1b09b687be16e69a9784d5b97b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6aee6a07a86ee73c7ba20e059b79c794" id="r_a6aee6a07a86ee73c7ba20e059b79c794"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_s_i_n_g_l_e___m_e_a_s.html">SINGLE_MEAS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6aee6a07a86ee73c7ba20e059b79c794">single_measurement</a> (uint8_t Phase)</td></tr>
<tr class="memdesc:a6aee6a07a86ee73c7ba20e059b79c794"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform a single measurement for a specific phase.  <br /></td></tr>
<tr class="separator:a6aee6a07a86ee73c7ba20e059b79c794"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac084ccf3f955bc4c19751d6b24aa3814" id="r_ac084ccf3f955bc4c19751d6b24aa3814"><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct_a_c_c_u___m_e_a_s.html">ACCU_MEAS</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac084ccf3f955bc4c19751d6b24aa3814">accurate_measurement</a> (uint8_t Phase)</td></tr>
<tr class="memdesc:ac084ccf3f955bc4c19751d6b24aa3814"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs accurate measurement of various parameters.  <br /></td></tr>
<tr class="separator:ac084ccf3f955bc4c19751d6b24aa3814"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abac8ce1f5096ff3f393117cbfa98f888" id="r_abac8ce1f5096ff3f393117cbfa98f888"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abac8ce1f5096ff3f393117cbfa98f888">start_calibration</a> (void)</td></tr>
<tr class="memdesc:abac8ce1f5096ff3f393117cbfa98f888"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the calibration process.  <br /></td></tr>
<tr class="separator:abac8ce1f5096ff3f393117cbfa98f888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b6736969ddf8f3f9f229c3ac4a24c23" id="r_a6b6736969ddf8f3f9f229c3ac4a24c23"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6b6736969ddf8f3f9f229c3ac4a24c23">toggle_Buzzer_settings</a> (bool btn)</td></tr>
<tr class="separator:a6b6736969ddf8f3f9f229c3ac4a24c23"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a38561fdc926275e79fcc8d74e1d56373" id="r_a38561fdc926275e79fcc8d74e1d56373"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a38561fdc926275e79fcc8d74e1d56373">State_BUZZER</a> = true</td></tr>
<tr class="separator:a38561fdc926275e79fcc8d74e1d56373"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a505d7c6b96ad0efb16bb1cdecdadae93" id="r_a505d7c6b96ad0efb16bb1cdecdadae93"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a505d7c6b96ad0efb16bb1cdecdadae93">State_LED</a> = true</td></tr>
<tr class="separator:a505d7c6b96ad0efb16bb1cdecdadae93"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Calculations for displaying the measurements. </p>
<hr  />
<h1><a class="anchor" id="autotoc_md0"></a>
Trigonometry used for distance and angle calculation</h1>
<h2><a class="anchor" id="autotoc_md1"></a>
Calibration</h2>
<p>For calibration the angle is given, because the board is placed perpendicular to the wire. <br  />
 The equation for this trigonometry can be seen under the figure. <br  />
 d: Distance from wire to pad (left or right) <br  />
 l: Distance from the board center to wire <br  />
 x: Distance from the board center to pad </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="#a903c0e7083ad87b2f7420dcdcd409f99" title="Distance from the board center to pad center.">D_P</a> Distance from the board center to pad</dd></dl>
<div class="image">
<img src="trigonometry_calibration.jpg" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md2"></a>
Measure</h2>
<p>The equation for this trigonometry can be seen under the figure.</p>
<div class="image">
<img src="trigonometry_measure.jpg" alt=""/>
</div>
<h1><a class="anchor" id="autotoc_md3"></a>
Approximation used for calculations</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Distance</h2>
<p>Approximation is done with a Laurent polynomial 2nd degree. <br  />
 For calibration only 3 measurements are needed. <br  />
 d1,d2,d3: Distance for each measurement <br  />
 s1,s2,s3: Signal for each measurement <br  />
 a,b,c: Coefficients for distance approximation</p>
<div class="image">
<img src="approximation_coefficient.jpg" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md5"></a>
Current</h2>
<p>Approximation is done with a constant as seen in the figure. <br  />
 For calibration only 1 measurements is needed. <br  />
 U: Signal <br  />
 r: Distance from the board center to wire <br  />
 const: Constant for current approximation.</p>
<div class="image">
<img src="approximation_constant.jpg" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md6"></a>
@todo Optimize Angle Calculation, Current Calculation, Calibration Hall Sensor</h2>
<dl class="section author"><dt>Author</dt><dd>Alejandro Horvat, <a href="#" onclick="location.href='mai'+'lto:'+'hor'+'va'+'ale'+'@s'+'tud'+'en'+'ts.'+'zh'+'aw.'+'ch'; return false;">horva<span class="obfuscator">.nosp@m.</span>ale@<span class="obfuscator">.nosp@m.</span>stude<span class="obfuscator">.nosp@m.</span>nts.<span class="obfuscator">.nosp@m.</span>zhaw.<span class="obfuscator">.nosp@m.</span>ch</a> </dd></dl>
<dl class="section date"><dt>Date</dt><dd>12.28.2021 </dd></dl>

<p class="definition">Definition in file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a55777447b30ba437527bda91f69b8fba" name="a55777447b30ba437527bda91f69b8fba"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55777447b30ba437527bda91f69b8fba">&#9670;&#160;</a></span>ACCURATE_MEASUREMENT_LOOPS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ACCURATE_MEASUREMENT_LOOPS&#160;&#160;&#160;10</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How many loops for accu. meas. </p>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00079">79</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<a id="a42e162ee7b8b8c2663d1dbd31c7b590b" name="a42e162ee7b8b8c2663d1dbd31c7b590b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42e162ee7b8b8c2663d1dbd31c7b590b">&#9670;&#160;</a></span>ARM_MATH_CM4</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ARM_MATH_CM4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00069">69</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<a id="aa43ea9575b79b5b1c302b382fe1f189e" name="aa43ea9575b79b5b1c302b382fe1f189e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa43ea9575b79b5b1c302b382fe1f189e">&#9670;&#160;</a></span>CALIBRATION_MEASUREMENT_LOOPS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CALIBRATION_MEASUREMENT_LOOPS&#160;&#160;&#160;50</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>How many loops for calibration meas. </p>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00080">80</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<a id="a903c0e7083ad87b2f7420dcdcd409f99" name="a903c0e7083ad87b2f7420dcdcd409f99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a903c0e7083ad87b2f7420dcdcd409f99">&#9670;&#160;</a></span>D_P</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define D_P&#160;&#160;&#160;19.7</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Distance from the board center to pad center. </p>
<p>&lt; pad border to center of board 8.26 mm (Pad to Board Center) + 22.86 mm (Board Width) / 2 = 19.69 mm (rounded to 19.7 mm) </p>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00078">78</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<a id="a1ac0abc7c913167ecaf81778d57e7a17" name="a1ac0abc7c913167ecaf81778d57e7a17"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1ac0abc7c913167ecaf81778d57e7a17">&#9670;&#160;</a></span>POW2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define POW2</td>
          <td>(</td>
          <td class="paramtype"></td>          <td class="paramname"><span class="paramname">x</span></td><td>)</td>
          <td>&#160;&#160;&#160;((x) * (x))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Power of two. </p>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00081">81</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a4fddab1b09b687be16e69a9784d5b97b" name="a4fddab1b09b687be16e69a9784d5b97b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fddab1b09b687be16e69a9784d5b97b">&#9670;&#160;</a></span>accurate_FFT()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_a_c_c_u___f_f_t.html">ACCU_FFT</a> accurate_FFT </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs accurate <a class="el" href="struct_f_f_t.html">FFT</a> calculation for signal strength and main frequency of each channel. </p>
<p>This function calculates the signal strength and main frequency for each channel using <a class="el" href="struct_f_f_t.html">FFT</a>. It performs accurate measurement loops and calculates the mean and standard deviation of the signal strength. If the standard deviation is larger than 100, it sets the error flag accordingly.</p>
<dl class="section return"><dt>Returns</dt><dd>The calculated <a class="el" href="struct_a_c_c_u___f_f_t.html">ACCU_FFT</a> structure containing the signal strength, standard deviation, and error flag. </dd></dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00196">196</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a4fddab1b09b687be16e69a9784d5b97b_cgraph.png" border="0" usemap="#acalculation_8c_a4fddab1b09b687be16e69a9784d5b97b_cgraph" alt=""/></div>
</div>

</div>
</div>
<a id="ac084ccf3f955bc4c19751d6b24aa3814" name="ac084ccf3f955bc4c19751d6b24aa3814"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac084ccf3f955bc4c19751d6b24aa3814">&#9670;&#160;</a></span>accurate_measurement()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_a_c_c_u___m_e_a_s.html">ACCU_MEAS</a> accurate_measurement </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Phase</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs accurate measurement of various parameters. </p>
<p>This function calculates the mean value and standard deviation of distance, angle, frequency, and current based on multiple single measurements. It checks for errors in the single measurements and sets the appropriate error flags. If the standard deviation of any parameter exceeds 100, it sets the error_accu flag to CALC_ERROR_DEVIATION_TOO_HIGH.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Phase</td><td>The phase for which the accurate measurement is performed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="struct_a_c_c_u___m_e_a_s.html">ACCU_MEAS</a> The structure containing the calculated values and error flags. </dd></dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00394">394</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_ac084ccf3f955bc4c19751d6b24aa3814_cgraph.png" border="0" usemap="#acalculation_8c_ac084ccf3f955bc4c19751d6b24aa3814_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_ac084ccf3f955bc4c19751d6b24aa3814_icgraph.png" border="0" usemap="#acalculation_8c_ac084ccf3f955bc4c19751d6b24aa3814_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a9e58222624315d1b9029cc0bd7757b70" name="a9e58222624315d1b9029cc0bd7757b70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e58222624315d1b9029cc0bd7757b70">&#9670;&#160;</a></span>calculate_coefficients_single_pad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_coefficients_single_pad </td>
          <td>(</td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>s</em>[], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>d</em>[], </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t *</td>          <td class="paramname"><span class="paramname"><em>a</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t *</td>          <td class="paramname"><span class="paramname"><em>b</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t *</td>          <td class="paramname"><span class="paramname"><em>c</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Calculates the coefficients for the distance approximation from an approximation based on a second degree polynomial.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>An array of three float32_t values representing x coordinates: x_0, x_1, x_2. </td></tr>
    <tr><td class="paramname">d</td><td>An array of three float32_t values representing y coordinates: y_0, y_1, y_2. </td></tr>
    <tr><td class="paramname">a</td><td>Pointer to a float32_t variable to store the calculated coefficient 'a'. </td></tr>
    <tr><td class="paramname">b</td><td>Pointer to a float32_t variable to store the calculated coefficient 'b'. </td></tr>
    <tr><td class="paramname">c</td><td>Pointer to a float32_t variable to store the calculated coefficient 'c'. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00531">531</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a9e58222624315d1b9029cc0bd7757b70_icgraph.png" border="0" usemap="#acalculation_8c_a9e58222624315d1b9029cc0bd7757b70_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a68538a6e3dec58db926981a4702d45fa" name="a68538a6e3dec58db926981a4702d45fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a68538a6e3dec58db926981a4702d45fa">&#9670;&#160;</a></span>calculate_distance_and_angle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_d_i_s_t_a_n_c_e___a_n_g_l_e.html">DISTANCE_ANGLE</a> calculate_distance_and_angle </td>
          <td>(</td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>signal_strength_r</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>signal_strength_l</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the distance and angle based on signal strengths. </p>
<p>This function takes the signal strengths of the right and left signals and calculates the distance and angle using predefined coefficients. The calculated values are stored in a <a class="el" href="struct_d_i_s_t_a_n_c_e___a_n_g_l_e.html">DISTANCE_ANGLE</a> structure and returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">signal_strength_r</td><td>The signal strength of the right signal. </td></tr>
    <tr><td class="paramname">signal_strength_l</td><td>The signal strength of the left signal. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The calculated distance and angle. </dd></dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00455">455</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a68538a6e3dec58db926981a4702d45fa_icgraph.png" border="0" usemap="#acalculation_8c_a68538a6e3dec58db926981a4702d45fa_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a9b4c4cf533fe366c1c5637d2853c823a" name="a9b4c4cf533fe366c1c5637d2853c823a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9b4c4cf533fe366c1c5637d2853c823a">&#9670;&#160;</a></span>calculate_freq_and_signalstrength()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_f_f_t.html">FFT</a> calculate_freq_and_signalstrength </td>
          <td>(</td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>input_samples</em>[]</span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the frequency and signal strength using Fast Fourier Transform (<a class="el" href="struct_f_f_t.html">FFT</a>). </p>
<p>This function takes an array of input samples and performs the following steps:</p><ol type="1">
<li>Removes the DC component from the input samples.</li>
<li>Performs <a class="el" href="struct_f_f_t.html">FFT</a> on the input samples to obtain the complex output.</li>
<li>Calculates the magnitude of the complex numbers.</li>
<li>Finds the index of the maximum magnitude in the first half of the array.</li>
<li>Determines the main frequency based on the maximum magnitude index.</li>
<li>Rounds the main frequency to either 50 Hz or 60 Hz.</li>
<li>Calculates the index of the rounded frequency.</li>
<li>Calculates the signal strength at the rounded frequency.</li>
<li>Returns the calculated main frequency and signal strength in a structure.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input_samples</td><td>The array of input samples. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The structure containing the calculated main frequency and signal strength. </dd></dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00137">137</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a9b4c4cf533fe366c1c5637d2853c823a_cgraph.png" border="0" usemap="#acalculation_8c_a9b4c4cf533fe366c1c5637d2853c823a_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a9b4c4cf533fe366c1c5637d2853c823a_icgraph.png" border="0" usemap="#acalculation_8c_a9b4c4cf533fe366c1c5637d2853c823a_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a131fe6481430eaff914b335bbf3d565d" name="a131fe6481430eaff914b335bbf3d565d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a131fe6481430eaff914b335bbf3d565d">&#9670;&#160;</a></span>calculate_magnetic_coefficients()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void calculate_magnetic_coefficients </td>
          <td>(</td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>s</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>d</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t</td>          <td class="paramname"><span class="paramname"><em>cal_current</em>, </span></td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float32_t *</td>          <td class="paramname"><span class="paramname"><em>a_magn</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculates the magnetic coefficients. </p>
<p>This function calculates the magnetic coefficients based on the given parameters.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>The value of s. </td></tr>
    <tr><td class="paramname">d</td><td>The value of d. </td></tr>
    <tr><td class="paramname">cal_current</td><td>The calibration current. </td></tr>
    <tr><td class="paramname">a_magn</td><td>Pointer to store the calculated magnetic coefficients. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00561">561</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a131fe6481430eaff914b335bbf3d565d_icgraph.png" border="0" usemap="#acalculation_8c_a131fe6481430eaff914b335bbf3d565d_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a6aee6a07a86ee73c7ba20e059b79c794" name="a6aee6a07a86ee73c7ba20e059b79c794"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6aee6a07a86ee73c7ba20e059b79c794">&#9670;&#160;</a></span>single_measurement()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct_s_i_n_g_l_e___m_e_a_s.html">SINGLE_MEAS</a> single_measurement </td>
          <td>(</td>
          <td class="paramtype">uint8_t</td>          <td class="paramname"><span class="paramname"><em>Phase</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform a single measurement for a specific phase. </p>
<p>This function starts the measurement, converts the samples to the specific channel, calculates the signal strength and main frequency for each channel using <a class="el" href="struct_f_f_t.html">FFT</a>, calculates the distance and angle, and calculates the current using the magnetic coefficients. It also performs error testing and optimization on the calculated values.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">Phase</td><td>The phase for which the measurement is performed (SINGLE_PHASE or THREE_PHASE). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The calculated values including frequency, distance, angle, current, and error status. </dd></dl>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00265">265</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a6aee6a07a86ee73c7ba20e059b79c794_cgraph.png" border="0" usemap="#acalculation_8c_a6aee6a07a86ee73c7ba20e059b79c794_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a6aee6a07a86ee73c7ba20e059b79c794_icgraph.png" border="0" usemap="#acalculation_8c_a6aee6a07a86ee73c7ba20e059b79c794_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="abac8ce1f5096ff3f393117cbfa98f888" name="abac8ce1f5096ff3f393117cbfa98f888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abac8ce1f5096ff3f393117cbfa98f888">&#9670;&#160;</a></span>start_calibration()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_calibration </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts the calibration process. </p>
<p>This function initializes the necessary variables and arrays for calibration. It calculates the coefficients for distance approximation and current approximation based on the calibration data stored in flash memory. </p>

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00487">487</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_abac8ce1f5096ff3f393117cbfa98f888_cgraph.png" border="0" usemap="#acalculation_8c_abac8ce1f5096ff3f393117cbfa98f888_cgraph" alt=""/></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_abac8ce1f5096ff3f393117cbfa98f888_icgraph.png" border="0" usemap="#acalculation_8c_abac8ce1f5096ff3f393117cbfa98f888_icgraph" alt=""/></div>
</div>

</div>
</div>
<a id="a6b6736969ddf8f3f9f229c3ac4a24c23" name="a6b6736969ddf8f3f9f229c3ac4a24c23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6b6736969ddf8f3f9f229c3ac4a24c23">&#9670;&#160;</a></span>toggle_Buzzer_settings()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void toggle_Buzzer_settings </td>
          <td>(</td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>btn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00566">566</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="calculation_8c_a6b6736969ddf8f3f9f229c3ac4a24c23_icgraph.png" border="0" usemap="#acalculation_8c_a6b6736969ddf8f3f9f229c3ac4a24c23_icgraph" alt=""/></div>
</div>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a38561fdc926275e79fcc8d74e1d56373" name="a38561fdc926275e79fcc8d74e1d56373"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38561fdc926275e79fcc8d74e1d56373">&#9670;&#160;</a></span>State_BUZZER</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool State_BUZZER = true</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00107">107</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
<a id="a505d7c6b96ad0efb16bb1cdecdadae93" name="a505d7c6b96ad0efb16bb1cdecdadae93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a505d7c6b96ad0efb16bb1cdecdadae93">&#9670;&#160;</a></span>State_LED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool State_LED = true</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="calculation_8c_source.html#l00108">108</a> of file <a class="el" href="calculation_8c_source.html">calculation.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
